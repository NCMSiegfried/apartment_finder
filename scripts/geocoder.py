from geopy.geocoders import Nominatim
from geopy.exc import GeocoderTimedOut, GeocoderUnavailable
import logging
from concurrent.futures import ThreadPoolExecutor, as_completed

class GeoCoder:
    def __init__(self, user_agent="address converter", max_workers=5):
        self.geolocator = Nominatim(user_agent=user_agent)
        self.max_workers = max_workers
        logging.basicConfig(level=logging.INFO)

    def geocode_address(self, address, attempt=1, max_attempts=1):
        try:
            location = self.geolocator.geocode(address, timeout=7)
            return (location.latitude, location.longitude) if location else (None, None)
        except (GeocoderTimedOut, GeocoderUnavailable) as e:
            if attempt < max_attempts:
                logging.warning(f"Geocoding attempt {attempt} failed for {address}, retrying...")
                return self.geocode_address(address, attempt + 1, max_attempts)
            else:
                logging.error(f"Geocoding failed after {max_attempts} attempts for {address}.")
                return None, None

    def batch_geocode(self, addresses):
        results = {}
        with ThreadPoolExecutor(max_workers=self.max_workers) as executor:
            future_to_address = {executor.submit(self.geocode_address, address): address for address in addresses}

            for future in as_completed(future_to_address):
                address = future_to_address[future]
                try:
                    results[address] = future.result()
                except Exception as exc:
                    logging.error(f"{address} generated an exception: {exc}")
                    results[address] = (None, None)
        return results

if __name__ == '__main__':
    geocoder = GeoCoder(max_workers=10)
    addresses = ['8001 S IH35, austin, tx', '801 W 5th St, austin, tx', '8000 Decker Ln, austin, tx', '8527 N Capital Of Texas Hwy N, austin, tx', '12151 I-35 N, austin, tx', '903-911 Battle Bend Blvd, austin, tx', '601 W Saint Johns Ave, austin, tx', '1910 Willow Creek Dr, austin, tx', '9220 N Interstate 35, austin, tx', '2400 San Gabriel St, austin, tx', '11511 Metric Blvd, austin, tx', '4413 Speedway, austin, tx', '2201 Montopolis Dr, austin, tx', '9500 Jollyville Rd, austin, tx', '10926 Jollyville Rd, austin, tx', '1900 Onion Creek Pky, austin, tx', '1705 Frontier Valley Dr, austin, tx', '6936 E Ben White Blvd, austin, tx', '12501 Tech Ridge Blvd, austin, tx', '130 Cumberland Rd, austin, tx', '1845 Burton Dr, austin, tx', '3704 Speedway, austin, tx', '8615 Rockwood Ln, austin, tx', '1300 E Riverside Dr, austin, tx', '1802 West Ave, austin, tx', '501 E Oltorf St, austin, tx', '6701 Rialto Blvd, austin, tx', '1824 S Interstate 35, austin, tx', '1930 W Rundberg Ln, austin, tx', '12001 Metric Blvd, austin, tx', '12148 Jollyville Rd, austin, tx', '8617 Spicewood Springs Rd, austin, tx', '2716 Barton Creek Blvd, austin, tx', '2425 Cromwell Cir, austin, tx', '1512 W 13th St, austin, tx', '333 E Slaughter Ln, austin, tx', '6500 Champion Grandview Way, austin, tx', '3501-3503 Speedway, austin, tx', '3220 Duval Rd, austin, tx', '1500 Faro Dr, austin, tx', '502 W Longspur Blvd, austin, tx', '4017 Victory Dr, austin, tx', '301 Brazos St, austin, tx', '7201 Ranch Road 2222, austin, tx', '2001 Ed Bluestein Blvd, austin, tx', '1501 Kinney Ave, austin, tx', '1500 Reagan Hill Dr, austin, tx', '10307 Morado Cove, austin, tx', '811 E 11th St, austin, tx', '2347 Douglas St, austin, tx', '9601 Middle Fiskville Rd, austin, tx', '10610 Morado Cir, austin, tx', '2400 E 6th St, austin, tx', '6000 Ed Bluestein Blvd, austin, tx', '13359 Pond Springs Rd, austin, tx', '9500 Dessau Rd, austin, tx', '1630 Rutland Dr, austin, tx', '7707 S Interstate 35 Hwy, austin, tx', '7607 Blessing Ave, austin, tx', '6511 Melrose Trl, austin, tx', '1113 Banister Ln, austin, tx', '400 Comal St, austin, tx', '2200 Panther Trl, austin, tx', '1405-1413 Clearfield Dr, austin, tx', '12600 McCallen Pass, austin, tx', '7610 Cameron Rd, austin, tx', '1919 Burton Dr, austin, tx', '3625 Duval Rd, austin, tx', '1020 45th St E, austin, tx', '9500 Alice Mae Ln, austin, tx', '8912 N Lamar Blvd, austin, tx', '6934 E Ben White Blvd, austin, tx', '1831 Wells Branch Pky, austin, tx', '6001 Shepherd Mountain Cv, austin, tx', '8700 Brodie Ln, austin, tx', '6811 Old Bee Caves Rd, austin, tx', '8524 Burnett Rd, austin, tx', '4716 Duval Rd, austin, tx', '2435 E Riverside Dr, austin, tx', '409 E William Cannon Dr E, austin, tx', '5321 Barton Creek Blvd, austin, tx', '1124 Rutland Dr, austin, tx', '5708 W Parmer Ln, austin, tx', '3508 S 1st St, austin, tx', '3300 Parker Ln, austin, tx', '11320 Manchaca Rd, austin, tx', '8001 Hwy 71 W, austin, tx', '1088 Park Plz, austin, tx', '1405-1407 W North Loop Blvd, austin, tx', '12612 N Lamar Blvd, austin, tx', '2200 S Pleasant Valley Rd, austin, tx', '2400 Wickersham Ln, austin, tx', '2501 Wickersham Ln, austin, tx', '1830 W Rundberg Ln, austin, tx', '11210 FM 2222, austin, tx', '3809 S Congress Ave, austin, tx', '2101 Burton Dr, austin, tx', '1219 S Lamar Blvd, austin, tx', '2333 Cascades Ave, austin, tx', '8505-8525 Shoal Creek Blvd, austin, tx', '10301 Burnet Rd, austin, tx', '2205 W Parmer Ln, austin, tx', '12007 N Lamar Blvd, austin, tx', '10801 Wayne Riddell Loop, austin, tx', '135 Foremost Dr, austin, tx', '3001 Scofield Ridge Pky, austin, tx', '4601 E St. Elmo Rd, austin, tx', '701 W 24th St, austin, tx', '2301 Grove Blvd, austin, tx', '4910 E 7th St, austin, tx', '5225 Jain Ln, austin, tx', '401 Masterson Pass, austin, tx', '1200 Treadwell St, austin, tx', '12101 N Lamar Blvd, austin, tx', '10300 Golden Meadow Dr, austin, tx', '8103 S Congress Ave, austin, tx', '5704-5902 Cougar Dr, austin, tx', '6212 Crow Ln, austin, tx', '809 S Lamar Blvd, austin, tx', '1200 W 40th St, austin, tx', '3218 Gonzales St, austin, tx', '12443 Tech Ridge Blvd, austin, tx', '1070 Mearns Meadow Blvd, austin, tx', '2223 Waterloo City Ln, austin, tx', '1215 W Slaughter Ln W, austin, tx', '1915 Wells Branch Pky, austin, tx', '400 W Saint Elmo Rd, austin, tx', '4316 Bull Creek Rd, austin, tx', '2401 E Oltorf St, austin, tx', '807 W Lynn St, austin, tx', '7908 Gault St, austin, tx', '2111 Rio Grande St, austin, tx', '5604 Southwest Pky, austin, tx', '2706 Wheless, austin, tx', '701 Woodward St, austin, tx', '1300 Pleasant Valley Rd S, austin, tx', '3300 Oak Creek Dr, austin, tx', '305 E Yager Ln, austin, tx', '9725 N Lake Creek Pky, austin, tx', '516 Dawson Rd, austin, tx', '2910 Medical Arts St, austin, tx', '8721 Eastern Heights Blvd, austin, tx', '6008 N Lamar Blvd, austin, tx', '4500 Nuckols Rd, austin, tx', '2832 E Martin Luther King Jr Blvd, austin, tx', '15001 Strathaven Pass, austin, tx', '2505 Longview St, austin, tx', '1338 Christopher Ave, austin, tx', '7655 N Ranch Road 620, austin, tx', '9218 Balcones Club Dr, austin, tx', '412 W Alpine Rd, austin, tx', '350 Cypress Creek Rd, austin, tx', '1912 E William Cannon Dr, austin, tx', '335 Cypress Creek Rd, austin, tx', '8585 Spicewood Springs Rd, austin, tx', '1230 E 38th 1/2 St, austin, tx', '1201 Lady Bird Ln, austin, tx', '2336 Douglas St, austin, tx', '2000 S Lakeline Blvd, austin, tx', '1003 Justin Ln, austin, tx', '12100 Metric Blvd, austin, tx', '9009 Great Hills Trl, austin, tx', '7011 W Parmer Ln W, austin, tx', '5106 N Lamar Blvd, austin, tx', '7227 Hwy 290 E, austin, tx', '5204 Charles Merle Dr, austin, tx', '1801 Wells Branch Pky, austin, tx', '11316 Jollyville Rd, austin, tx', '1611 W 5th St, austin, tx', '3440 Ranch Trails, austin, tx', '9300 Northgate Blvd, austin, tx', '2022 E Slaughter Ln, austin, tx', '824 Camino La Costa, austin, tx', '11266 Taylor Draper Ln, austin, tx', '12001 Dessau Rd, austin, tx', '3101 Wells Branch Pky, austin, tx', '6020 S 1st St, austin, tx', '14745 Merrilltown, austin, tx', '7121 Elroy Rd, austin, tx', '14000 The Lakes Blvd, austin, tx', '2704 Rio Grande St, austin, tx', '9911 Dessau Rd, austin, tx', '7500 S IH-35, austin, tx', '605 Masterson Pass, austin, tx', '1521 Reagan Hill Dr, austin, tx', '3300 W Wells Branch Pky, austin, tx', '4701 Staggerbrush Rd, austin, tx', '2601 Scofield Ridge Pky, austin, tx', '3816 S Lamar Blvd, austin, tx', '744 W William Cannon Dr W, austin, tx', '11300 W Parmer Ln W, austin, tx', '4009 Victory Dr, austin, tx', '827 W 12th St, austin, tx', '2515 Pearl St, austin, tx', '6309 Burns St, austin, tx', '2500 E William Cannon Dr, austin, tx', '2604 Manor Rd, austin, tx', '10101 S 1st St, austin, tx', '3209 S IH 35, austin, tx', '11500 Jollyville Rd, austin, tx', '2401 W Pflugerville Pky, austin, tx', '1833 Cheddar Loop, austin, tx', '2815 Guadalupe St, austin, tx', '2600 Lake Austin Blvd, austin, tx', '4600 W Guadalupe St, austin, tx', '6307 Bluff Springs Rd, austin, tx', '14200 The Lakes Blvd, austin, tx', '300 West Ave, austin, tx', '1016 Camino La Costa, austin, tx', '11441 N IH 35, austin, tx', '412 E William Cannon Dr E, austin, tx', '4411 Airport Blvd, austin, tx', '507 Pressler St, austin, tx', '14100 Thermal Dr, austin, tx', '400 W Anderson Ln, austin, tx', '13535 Lyndhurst St, austin, tx', '1114 Camino La Costa, austin, tx', '5453 Burnet Rd, austin, tx', '1200 Barton Hills Dr, austin, tx', '404 E 30th St, austin, tx', '5001 Convict Hill Rd, austin, tx', '13100 Avery Ranch Blvd, austin, tx', '500 E Anderson Ln, austin, tx', '3500 N Capital of TX Hwy, austin, tx', '16304 FM 1325, austin, tx', '8805 N Plaza Dr, austin, tx', '10127 Middle Fiskville Rd, austin, tx', '2612 Guadalupe St, austin, tx', '9019 N Lake Creek Pky, austin, tx', '8000 Highway 290 W, austin, tx', '515 E Slaughter Ln, austin, tx', '2104 E Anderson Ln, austin, tx', '8225 N FM 620, austin, tx', '1501 W Howard Ln, austin, tx', '3111 Parker Ln, austin, tx', '404 Rio Grande St, austin, tx', '7001 S Congress Ave S, austin, tx', '6201 Sneed Cove, austin, tx',]
    results = geocoder.batch_geocode(addresses)
    for address, (lat, lon) in results.items():
        print(f"{address}: Latitude = {lat}, Longitude = {lon}")